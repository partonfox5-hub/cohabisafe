<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onboarding - Cohabisafe</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header role="banner">
        <h1>Cohabisafe Onboarding</h1>
        <p class="progress">Step <%= step %> of <%= totalSteps %>: Quick Setup</p>
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="<%= totalSteps %>" aria-label="Onboarding progress">
            <div class="progress-fill" style="width: 0%;"></div>
        </div>
    </header>

    <main role="main">
        <form action="/renter-start" method="POST" novalidate>
            <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
                <ul role="alert" class="error-list">
                    <% errors.forEach(error => { %>
                        <li><%= error.msg %></li>
                    <% }); %>
                </ul>
            <% } %>

            <fieldset>
                <legend>Optional: Sign up with email to save progress</legend>
                <label for="email">Email (optional):</label>
                <input type="email" id="email" name="email" value="<%= typeof body !== 'undefined' ? body.email : '' %>" aria-describedby="email-help">
                <small id="email-help">We'll send match updates. You can skip and continue as guest.</small>
            </fieldset>

            <fieldset>
                <legend>Consent</legend>
                <label class="checkbox-label">
                    <input type="checkbox" id="consent" name="consent" value="true" <%= typeof body !== 'undefined' && body.consent === 'true' ? 'checked' : '' %> aria-required="true">
                    I agree to Cohabisafe terms and FCRA screening if selecting Elite tier.
                </label>
                <div role="alert" id="consent-error" class="error" style="display:none;">Please agree to continue.</div>
            </fieldset>

            <button type="submit" class="btn-primary">Continue to Tiers</button>
            <button type="button" class="btn-secondary" onclick="window.location.href='/tiers'">Skip Signup</button>
        </form>
    </main>

    <footer role="contentinfo">
        <p><a href="/terms">Terms</a> | <a href="/privacy">Privacy</a></p>
    </footer>

    <script>
        // WCAG: Focus management and validation
        document.getElementById('consent').addEventListener('change', function() {
            const error = document.getElementById('consent-error');
            if (this.checked) {
                error.style.display = 'none';
            }
        });

        // Form validation
        const form = document.querySelector('form');
        form.addEventListener('submit', function(e) {
            if (!document.getElementById('consent').checked) {
                e.preventDefault();
                document.getElementById('consent-error').style.display = 'block';
                document.getElementById('consent').focus();
            }
        });
    </script>
</body>
</html>