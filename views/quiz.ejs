<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personality Quiz - Cohabisafe</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header role="banner">
        <h1><%= section === 'personality' ? 'Personality Test' : section === 'environment' ? 'Preferred Environment Test' : 'Building Preferences' %></h1>
        <p class="progress">Step 3 of 6: <%= section.charAt(0).toUpperCase() + section.slice(1) %> Section</p>
        <div class="progress-bar" role="progressbar" id="progressBar" aria-valuenow="<%= answered %>" aria-valuemin="0" aria-valuemax="<%= questions %>" aria-label="Quiz progress">
            <div class="progress-fill" id="progressFill" style="width: <%= (answered / questions * 100) %>%"></div>
        </div>
        <p id="progressText" aria-live="polite">Answered: <%= answered %> of <%= questions %></p>
    </header>

    <main id="main-content" role="main">
        <form id="quizForm" novalidate>
            <fieldset id="questionsFieldset">
                <legend>Answer the following questions</legend>
                <% if (section === 'personality') { %>
                    <!-- Openness to Experience (8 Qs) -->
                    <section aria-labelledby="openness-heading">
                        <h2 id="openness-heading">Openness to Experience</h2>
                        <p aria-describedby="openness-tip">This measures creativity, curiosity, and adaptability.</p>
                        <small id="openness-tip">Be honest for better matches.</small>

                        <!-- Q1: Likert -->
                        <div class="question" data-qid="1">
                            <label for="q1">I enjoy exploring new ideas and concepts, even if they're unconventional.</label>
                            <div class="radio-group likert" role="radiogroup" aria-labelledby="q1-label">
                                <input type="radio" id="q1-1" name="q1" value="1" aria-required="true">
                                <label for="q1-1">Strongly Disagree</label>
                                <input type="radio" id="q1-2" name="q1" value="2">
                                <label for="q1-2">Disagree</label>
                                <input type="radio" id="q1-3" name="q1" value="3">
                                <label for="q1-3">Neutral</label>
                                <input type="radio" id="q1-4" name="q1" value="4">
                                <label for="q1-4">Agree</label>
                                <input type="radio" id="q1-5" name="q1" value="5">
                                <label for="q1-5">Strongly Agree</label>
                            </div>
                        </div>

                        <!-- Q2: Reverse Likert -->
                        <div class="question" data-qid="2" id="q2-container" style="display: block;">
                            <label for="q2">I prefer routine tasks over trying something new and different. (Reverse scored)</label>
                            <div class="radio-group likert" role="radiogroup" aria-labelledby="q2-label">
                                <input type="radio" id="q2-1" name="q2" value="1">
                                <label for="q2-1">Strongly Disagree</label>
                                <!-- ... similar for 2-5, value 1-5 but JS reverses to 5-1 -->
                            </div>
                        </div>

                        <!-- Q3: Slider -->
                        <div class="question" data-qid="3">
                            <label for="q3">I have a vivid imagination and often daydream about possibilities.</label>
                            <input type="range" id="q3" name="q3" min="1" max="10" value="5" aria-valuemin="1" aria-valuemax="10" aria-valuenow="5" aria-valuetext="Neutral">
                            <span id="q3-value">5</span> (Low imagination to High imagination)
                        </div>

                        <!-- Q4: Toggle with textarea -->
                        <div class="question" data-qid="4">
                            <label>Art and aesthetics matter a lot to me; I seek beauty in my surroundings.</label>
                            <div class="toggle-group" role="radiogroup">
                                <button type="button" role="radio" aria-checked="false" tabindex="0" data-value="no">No</button>
                                <button type="button" role="radio" aria-checked="false" tabindex="-1" data-value="yes">Yes</button>
                            </div>
                            <textarea id="q4-explain" name="q4-explain" placeholder="Explain why aesthetics matter to you..." style="display: none;" aria-describedby="q4-instructions"></textarea>
                            <small id="q4-instructions">Optional explanation if Yes.</small>
                        </div>

                        <!-- Q5: Likert -->
                        <div class="question" data-qid="5">
                            <label for="q5">I'm comfortable with ambiguity and change in my daily life.</label>
                            <div class="radio-group likert" role="radiogroup" aria-describedby="q5-desc">
                                <!-- Similar radio inputs value 1-5 -->
                            </div>
                            <small id="q5-desc">This helps match adaptable roommates.</small>
                        </div>

                        <!-- Additional Openness Qs (6-8) -->
                        <div class="question" data-qid="6">
                            <label for="q6">I like to explore abstract ideas that challenge my beliefs.</label>
                            <div class="radio-group likert"><!-- Radios 1-5 --></div>
                            <small id="openness-tip-extra">This measures intellectual curiosity.</small>
                        </div>

                        <div class="question" data-qid="7">
                            <label for="q7">I find it exciting to learn about cultures different from my own.</label>
                            <input type="range" id="q7" name="q7" min="1" max="10" value="5"><!-- Slider --></input>
                            <span id="q7-value">5</span> (Uninterested to Highly Excited)
                            <!-- Icon: <img src="/icons/globe.png" alt="Global cultures" aria-hidden="true"> -->
                        </div>

                        <div class="question" data-qid="8" id="q8-container">
                            <label>I prefer practical solutions over theoretical discussions. (Reverse)</label>
                            <div class="toggle-group"><!-- Toggle Practical/Theoretical --></div>
                        </div>

                    </section>

                    <!-- Conscientiousness (7 Qs: Q9-15) -->
                    <section aria-labelledby="conscientious-heading">
                        <h2 id="conscientious-heading">Conscientiousness</h2>
                        <!-- Similar structure for Q9-15: Mix of Likert, Slider, Toggle with photos, etc. -->
                        <!-- Example Q9: Likert "I always follow a cleaning schedule..." -->
                        <!-- Q10: Slider "Planning preference" -->
                        <!-- Q11: Reverse Likert -->
                        <!-- Q12: Toggle with photos (Minimalist, Lived-In, Clutter OK) - use images with alt -->
                        <!-- Q13: Likert -->
                        <!-- Q14: Double-check work Likert -->
                        <!-- Q15: Goal slider -->
                    </section>

                    <!-- Extraversion (8 Qs: Q16-23) -->
                    <section aria-labelledby="extraversion-heading">
                        <h2 id="extraversion-heading">Extraversion</h2>
                        <!-- Q16: Likert hosting -->
                        <!-- Q17: Slider solo vs group -->
                        <!-- Q18: Likert energized -->
                        <!-- Q19: Toggle small/large (reverse) -->
                        <!-- Q20: Likert initiate -->
                        <!-- Q21: Likert thrive social -->
                        <!-- Q22: Toggle attention -->
                        <!-- Q23: Slider team vs solo -->
                    </section>

                    <!-- Agreeableness (7 Qs: Q24-30) -->
                    <section aria-labelledby="agreeableness-heading">
                        <h2 id="agreeableness-heading">Agreeableness</h2>
                        <!-- Q24: Likert compromise -->
                        <!-- Q25: Slider helpful -->
                        <!-- Q26: Likert forgive -->
                        <!-- Q27: Toggle confrontational -->
                        <!-- Q28: Likert get along -->
                        <!-- Q29: Slider empathetic -->
                        <!-- Q30: Toggle reciprocal -->
                    </section>

                    <!-- Neuroticism (5 Qs: Q31-35) -->
                    <section aria-labelledby="neuroticism-heading">
                        <h2 id="neuroticism-heading">Neuroticism</h2>
                        <p aria-live="polite" id="neuroticism-summary">Section summary will appear here.</p>
                        <!-- Q31: Reverse Likert unexpected guests -->
                        <!-- Q32: Slider worry -->
                        <!-- Q33: Reverse Likert calm pressure -->
                        <!-- Q34: Likert stressed social -->
                        <!-- Q35: Reverse Likert anxious new -->
                    </section>
                <% } else if (section === 'environment') { %>
                    <!-- Environment Test: 22 Questions on Habits (Inferred: Similar mix for cleanliness, noise, etc.) -->
                    <section aria-labelledby="environment-heading">
                        <h2 id="environment-heading">Preferred Environment</h2>
                        <!-- Example Q1: Likert "I prefer a spotless kitchen..." -->
                        <!-- Sliders for noise tolerance, cleanliness level -->
                        <!-- Toggles for shared habits like cooking, guests -->
                        <!-- Multi-select for daily routines (e.g., wake/sleep times) -->
                        <!-- Total 22: Grouped into sub-sections like Cleanliness (5), Noise (5), Guests (4), Routines (4), etc. -->
                        <!-- Placeholder for brevity: Implement similar to personality -->
                        <div class="question" data-qid="env1">
                            <label for="env1">How important is cleanliness in shared spaces?</label>
                            <input type="range" id="env1" name="env1" min="1" max="10" value="5">
                            <span id="env1-value">5</span> (Not important to Very important)
                        </div>
                        <!-- ... 21 more similar questions ... -->
                    </section>
                <% } else if (section === 'building') { %>
                    <!-- Building Preferences: 10 Multi-Select Questions -->
                    <section aria-labelledby="building-heading">
                        <h2 id="building-heading">Building Preferences</h2>
                        <p>Select up to 5-7 options per question.</p>

                        <!-- Q1: Neighborhood Vibe Multi-Select -->
                        <div class="question" data-qid="b1">
                            <label for="b1-group">Preferred neighborhood vibe?</label>
                            <fieldset class="checkbox-group" role="group" aria-labelledby="b1-heading" id="b1-group">
                                <legend id="b1-heading">Choose multiple</legend>
                                <div class="optgroup">
                                    <label>High-Energy Urban</label>
                                    <ul>
                                        <li><label><input type="checkbox" name="b1[]" value="urban-bustling"> Urban Bustling</label></li>
                                        <!-- ... other urban options ... -->
                                    </ul>
                                </div>
                                <!-- Similar optgroups for Suburban, Rural -->
                            </fieldset>
                            <span id="b1-counter" aria-live="polite">Selected: 0 / 5</span>
                        </div>

                        <!-- Q2: Rent Budget Slider + Checkboxes -->
                        <div class="question" data-qid="b2">
                            <label for="b2">Max monthly rent budget ($500â€“$2000)</label>
                            <input type="range" id="b2" name="b2" min="500" max="2000" step="50" value="1000" aria-valuetext="$1000">
                            <span id="b2-value">$1000</span>
                            <fieldset class="checkbox-group">
                                <!-- Flexible factors checkboxes -->
                                <label><input type="checkbox" name="b2-flex[]" value="utilities"> Flexible with Utilities Included</label>
                                <!-- ... 7 more ... -->
                            </fieldset>
                        </div>

                        <!-- Q3-10: Similar multi-select for amenities, commute, pets, accessibility, shared spaces, noise, sustainability, proximity -->
                        <!-- Example Q3 Amenities -->
                        <div class="question" data-qid="b3">
                            <label>Must-have amenities?</label>
                            <fieldset class="checkbox-group">
                                <div class="optgroup" label="Fitness/Health">
                                    <label><input type="checkbox" name="b3[]" value="gym"> In-Building Gym</label>
                                    <!-- ... -->
                                </div>
                                <!-- Other groups -->
                            </fieldset>
                            <span id="b3-counter">Selected: 0 / 7</span>
                        </div>
                        <!-- Repeat pattern for Q4-10 with specific options from prompt -->
                    </section>
                <% } %>

                <div role="alert" id="validationAlert" style="display:none;" class="error">Please answer at least 80% of questions to continue.</div>
            </fieldset>

            <button type="button" id="nextBtn" class="btn-primary" onclick="submitSection()">Complete <%= section %> Section</button>
            <button type="button" class="btn-secondary" onclick="window.history.back()">Back</button>
        </form>
    </main>

    <footer role="contentinfo">
        <p><a href="/terms">Terms</a> | <a href="/privacy">Privacy</a></p>
    </footer>

    <script src="/js/quiz.js"></script>
    <script>
        // Initialize quiz for current section
        const section = '<%= section %>';
        const totalQuestions = <%= questions %>;
        initQuiz(section, totalQuestions, <%= answered %>);
    </script>
</body>
</html>